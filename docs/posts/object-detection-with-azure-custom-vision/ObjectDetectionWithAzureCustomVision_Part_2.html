<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Francisco Mussari">
<meta name="dcterms.date" content="2022-10-15">

<title>datamatica - Telecom Equipment Detection with Azure Custom Vision (Free) - Part 2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">datamatica</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">About</a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/fmussari"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/francisco-mussari-432b781a6/"><i class="bi bi-linkedin" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Telecom Equipment Detection with Azure Custom Vision (Free) - Part 2</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">computer-vision</div>
                <div class="quarto-category">deeplearning</div>
                <div class="quarto-category">azure</div>
                <div class="quarto-category">custom-vision</div>
                <div class="quarto-category">object-detection</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Francisco Mussari </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">October 15, 2022</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#tutorial-parts" id="toc-tutorial-parts" class="nav-link" data-scroll-target="#tutorial-parts">Tutorial Parts</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  <li><a href="#part-2.1.-labeling-the-images" id="toc-part-2.1.-labeling-the-images" class="nav-link" data-scroll-target="#part-2.1.-labeling-the-images">Part 2.1. Labeling the Images</a>
  <ul class="collapse">
  <li><a href="#install-and-import-libraries" id="toc-install-and-import-libraries" class="nav-link" data-scroll-target="#install-and-import-libraries">Install and import libraries</a></li>
  <li><a href="#credentials-and-services" id="toc-credentials-and-services" class="nav-link" data-scroll-target="#credentials-and-services">Credentials and services</a></li>
  <li><a href="#creating-labels" id="toc-creating-labels" class="nav-link" data-scroll-target="#creating-labels">Creating Labels</a></li>
  <li><a href="#upload-regions-from-json-file" id="toc-upload-regions-from-json-file" class="nav-link" data-scroll-target="#upload-regions-from-json-file">Upload Regions from json file</a></li>
  <li><a href="#verifying-the-number-of-created-regions" id="toc-verifying-the-number-of-created-regions" class="nav-link" data-scroll-target="#verifying-the-number-of-created-regions">Verifying the number of created Regions</a></li>
  <li><a href="#draw-some-regions" id="toc-draw-some-regions" class="nav-link" data-scroll-target="#draw-some-regions">Draw some regions</a></li>
  </ul></li>
  <li><a href="#part-2.2.-train-and-test-a-model" id="toc-part-2.2.-train-and-test-a-model" class="nav-link" data-scroll-target="#part-2.2.-train-and-test-a-model">Part 2.2. Train and Test a Model</a>
  <ul class="collapse">
  <li><a href="#explore-pictures" id="toc-explore-pictures" class="nav-link" data-scroll-target="#explore-pictures">Explore pictures</a></li>
  <li><a href="#upload-the-pictures-to-custom-vision-service" id="toc-upload-the-pictures-to-custom-vision-service" class="nav-link" data-scroll-target="#upload-the-pictures-to-custom-vision-service">Upload the pictures to Custom Vision Service</a></li>
  </ul></li>
  <li><a href="#part-1.3.-explore-data-from-custom-vision-service" id="toc-part-1.3.-explore-data-from-custom-vision-service" class="nav-link" data-scroll-target="#part-1.3.-explore-data-from-custom-vision-service">Part 1.3. Explore Data from Custom Vision Service</a>
  <ul class="collapse">
  <li><a href="#get-ids-of-uploaded-images" id="toc-get-ids-of-uploaded-images" class="nav-link" data-scroll-target="#get-ids-of-uploaded-images">Get id’s of uploaded images</a></li>
  <li><a href="#the-images-are-resized-when-uploaded" id="toc-the-images-are-resized-when-uploaded" class="nav-link" data-scroll-target="#the-images-are-resized-when-uploaded">The images are resized when uploaded</a></li>
  <li><a href="#keep-track-of-original-size-vs.-size-in-the-service" id="toc-keep-track-of-original-size-vs.-size-in-the-service" class="nav-link" data-scroll-target="#keep-track-of-original-size-vs.-size-in-the-service">Keep track of original size vs.&nbsp;size in the service</a></li>
  <li><a href="#checking-consistency-in-the-ratios" id="toc-checking-consistency-in-the-ratios" class="nav-link" data-scroll-target="#checking-consistency-in-the-ratios">Checking consistency in the ratios</a></li>
  <li><a href="#exporting-csv-with-size-data" id="toc-exporting-csv-with-size-data" class="nav-link" data-scroll-target="#exporting-csv-with-size-data">Exporting csv with size data</a></li>
  </ul></li>
  <li><a href="#conslusions" id="toc-conslusions" class="nav-link" data-scroll-target="#conslusions">Conslusions</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>Part 2. Label images with Smart Labeler</p>
<p><img src="./blog-pictures/Part-2.PNG" class="img-fluid"></p>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>In this series of posts we are going to follow along the process and code required to train an <em>object detection</em> model using <a href="https://azure.microsoft.com/en-us/pricing/details/cognitive-services/custom-vision-service">Azure Custom Vision</a> (in its free tier).</p>
<p>-&gt; We are going to use real world pictures compiled from work I have done over the years in Venezuela. In this kind of <em>supervised learning</em> problem we need tagged images. So we will use <a href="https://learn.microsoft.com/en-us/azure/cognitive-services/custom-vision-service/suggested-tags">Smart Labeler</a> to do that.</p>
<p>After the model is published in Azure service, we can use the API to build and share a demo with <a href="https://gradio.app/">Gradio</a> and <a href="https://huggingface.co/">Huggingface</a>.</p>
<p>Here is the one that is already published for you to try:<br>
<a href="https://huggingface.co/spaces/fmussari/Telecom-Object-Detection">Telecom-Object-Detection</a></p>
<section id="the-model-will-be-trained-to-detect-the-following-objects" class="level4">
<h4 class="anchored" data-anchor-id="the-model-will-be-trained-to-detect-the-following-objects">The model will be trained to detect the following objects:</h4>
<ul>
<li>Grid Antenna</li>
<li>Panel antenna</li>
<li>Radome antenna</li>
<li>RRU</li>
<li>Shroud antenna</li>
<li>Solid antenna</li>
</ul>

<table>
<tbody><tr>
<td>
<img src="blog-pictures/Grid.jpg" alt="1" width="200px" height="200px">
</td>
<td>
<img src="blog-pictures/Panel.jpg" alt="2" width="200px" height="200px">
</td>
<td>
<img src="blog-pictures/Radome.jpg" alt="2" width="200px" height="200px">
</td>
</tr>
<tr>
<td>
Grid
</td>
<td>
Panel
</td>
<td>
Radome
</td>
</tr>
<tr>
<td>
<img src="blog-pictures/RRU.jpg" alt="1" width="200px" height="200px">
</td>
<td>
<img src="blog-pictures/Shroud.jpg" alt="1" width="200px" height="200px">
</td>
<td>
<img src="blog-pictures/Solid.jpg" alt="1" width="200px" height="200px">
</td>
</tr>
<tr>
<td>
RRU
</td>
<td>
Shroud
</td>
<td>
Solid
</td>
</tr>

</tbody></table>
</section>
</section>
<section id="tutorial-parts" class="level2">
<h2 class="anchored" data-anchor-id="tutorial-parts">Tutorial Parts</h2>
<ul>
<li>Part 1 will cover:
<ul>
<li>Creating a <a href="https://azure.microsoft.com/en-us/pricing/details/cognitive-services/custom-vision-service/#pricing">free</a> Azure <a href="https://www.customvision.ai/">Custom Vision</a> Service.</li>
<li>Uploading the images to the service.</li>
</ul></li>
<li>Part 2 will cover:
<ul>
<li>Analyzing what happens to the images after uploading.</li>
<li>How to label the images using <a href="https://learn.microsoft.com/en-us/azure/cognitive-services/custom-vision-service/suggested-tags">Smart Labeler</a></li>
<li>Training and publishing the model.</li>
</ul></li>
<li>Part 3 will cover:
<ul>
<li>Create a Huggingface Gradio Demo.</li>
</ul></li>
</ul>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<ul>
<li>Custom Vision Documentation: <a href="https://learn.microsoft.com/en-us/azure/cognitive-services/custom-vision-service/suggested-tags">Label images faster with Smart Labeler</a></li>
<li>Microsoft Learn Excersice: <a href="https://microsoftlearning.github.io/AI-102-AIEngineer/Instructions/18-object-detection.html">Detect Objects in Images with Custom Vision</a></li>
<li>Custom Vision Documentation: <a href="https://docs.microsoft.com/en-us/azure/cognitive-services/custom-vision-service/quickstarts/object-detection?tabs=visual-studio&amp;pivots=programming-language-python">Quickstart: Create an object detection project with the Custom Vision client library</a></li>
<li>REST API Endpoint: <a href="https://docs.microsoft.com/en-us/rest/api/custom-vision/">Custom Vision REST API reference - Azure Cognitive Services</a></li>
<li>APIs Documentation: <a href="https://southcentralus.dev.cognitive.microsoft.com/docs/services/Custom_Vision_Training_3.3">Custom_Vision_Training_3.3</a></li>
<li>Azure SDK for Python: <a href="https://learn.microsoft.com/en-us/python/api/overview/azure/cognitiveservices-vision-customvision-readme?view=azure-python">Custom Vision Client Library</a></li>
<li>Source Code: <a href="https://github.com/Azure/azure-sdk-for-python/blob/main/sdk/cognitiveservices/azure-cognitiveservices-vision-customvision/azure/cognitiveservices/vision/customvision/training/operations/_custom_vision_training_client_operations.py">Azure/azure-sdk-for-python</a></li>
</ul>
</section>
<section id="part-2.1.-labeling-the-images" class="level2">
<h2 class="anchored" data-anchor-id="part-2.1.-labeling-the-images">Part 2.1. Labeling the Images</h2>
<p><strong>Smart Labeler</strong> is a simple tool for labeling images. It can be used for classification and object detection problems. When working in this problem I missed the ability to zoom-in when labeling some small objects.</p>
<p>For speeding up bigger projects it might be usefull that you can first label some pictures, then train and get suggestions for the untagged images, but I didn’t use it. By default the labeler tries to give suggestions even without training.</p>
<p>The process is simple and you can the use the annotation to train models outside the service (as we are going to try after this serie, using fastai).</p>
<section id="install-and-import-libraries" class="level3">
<h3 class="anchored" data-anchor-id="install-and-import-libraries">Install and import libraries</h3>
<p>We need to install Custom Vision’s Python SDK and python-dotenv:<br>
<code>! pip install azure-cognitiveservices-vision-customvision==3.1.0</code><br>
<code>! pip install python-dotenv</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> azure.cognitiveservices.vision.customvision.training <span class="im">import</span> CustomVisionTrainingClient</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> azure.cognitiveservices.vision.customvision.training.models <span class="im">import</span> ImageFileCreateBatch, ImageFileCreateEntry, Region, ImageRegionCreateEntry</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> msrest.authentication <span class="im">import</span> ApiKeyCredentials</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image, ImageOps</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> UnidentifiedImageError</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> patches, patheffects</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="credentials-and-services" class="level3">
<h3 class="anchored" data-anchor-id="credentials-and-services">Credentials and services</h3>
<ul>
<li><code>ApiKeyCredentials</code></li>
<li><code>CustomVisionTrainingClient</code></li>
<li><code>CustomVisionTrainingClient.get_project()</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>DOTENV_PATH <span class="op">=</span> <span class="st">'./.env'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>load_dotenv(DOTENV_PATH)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>training_endpoint <span class="op">=</span> os.getenv(<span class="st">'TrainingEndpoint'</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>training_key <span class="op">=</span> os.getenv(<span class="st">'TrainingKey'</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>project_id <span class="op">=</span> os.getenv(<span class="st">'ProjectID'</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>credentials <span class="op">=</span> ApiKeyCredentials(in_headers<span class="op">=</span>{<span class="st">"Training-key"</span>: training_key})</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>training_client <span class="op">=</span> CustomVisionTrainingClient(training_endpoint, credentials)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>custom_vision_project <span class="op">=</span> training_client.get_project(project_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="creating-labels" class="level3">
<h3 class="anchored" data-anchor-id="creating-labels">Creating Labels</h3>
<p>Since I already did the manual tagging, we can use those tags in this new project.<br>
First we need to create the labels/tags in the service: - <a href="https://learn.microsoft.com/en-us/python/api/azure-cognitiveservices-vision-customvision/azure.cognitiveservices.vision.customvision.training.operations.customvisiontrainingclientoperationsmixin?view=azure-python#azure-cognitiveservices-vision-customvision-training-operations-customvisiontrainingclientoperationsmixin-create-tag"><code>CustomVisionTrainingClient.create_tag()</code></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>tags <span class="op">=</span> [<span class="st">'Grid'</span>, <span class="st">'Panel'</span>, <span class="st">'Radome'</span>, <span class="st">'RRU'</span>, <span class="st">'Shroud'</span>, <span class="st">'Solid'</span>]</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>desc <span class="op">=</span> [<span class="st">'Grid Antenna'</span>, <span class="st">'Panel Cel. Antenna'</span>, <span class="st">'Radome Antenna'</span>, </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">'RRU Equipment'</span>, <span class="st">'Shroud Antenna'</span>, <span class="st">'Solid Antenna'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>service_tags <span class="op">=</span> []</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, tag <span class="kw">in</span> <span class="bu">enumerate</span>(tags):</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    service_tags.append(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        training_client.create_tag(</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>            project_id<span class="op">=</span>project_id, name<span class="op">=</span>tag,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>            description<span class="op">=</span>desc[i]</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>service_tags</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[&lt;azure.cognitiveservices.vision.customvision.training.models._models_py3.Tag&gt;,
 &lt;azure.cognitiveservices.vision.customvision.training.models._models_py3.Tag&gt;,
 &lt;azure.cognitiveservices.vision.customvision.training.models._models_py3.Tag&gt;,
 &lt;azure.cognitiveservices.vision.customvision.training.models._models_py3.Tag&gt;,
 &lt;azure.cognitiveservices.vision.customvision.training.models._models_py3.Tag&gt;,
 &lt;azure.cognitiveservices.vision.customvision.training.models._models_py3.Tag&gt;]</code></pre>
</div>
</div>
<p>Now we can see this in the service:<br>
<img src="./blog-pictures/Part-2-Tags.PNG" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>service_tag_ids <span class="op">=</span> {tag.name: tag.<span class="bu">id</span> <span class="cf">for</span> tag <span class="kw">in</span> service_tags}</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>service_tag_ids</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'Grid': 'e016b6a4-49e6-4897-a0c7-d8fc64d032f1',
 'Panel': 'c9b15b62-6823-44a4-8fee-fa9d84e65a7e',
 'Radome': 'a1020654-79c5-4d8a-867c-93dfb2a4a81d',
 'RRU': '91ffb5b0-fe25-4d72-9c65-14793183a3b9',
 'Shroud': '4e413c15-141a-419b-a958-1485008b2904',
 'Solid': '3f13d9b0-7b4d-4679-8fb8-7855cea0a118'}</code></pre>
</div>
</div>
</section>
<section id="upload-regions-from-json-file" class="level3">
<h3 class="anchored" data-anchor-id="upload-regions-from-json-file">Upload Regions from json file</h3>
<p>As I pointed before, you can create all the regions with Smart Labeler. Since I did that already in a previos project, I updated the region’s image ids and tags to the ones in this project and save them as a json.</p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/python/api/azure-cognitiveservices-vision-customvision/azure.cognitiveservices.vision.customvision.training.operations.customvisiontrainingclientoperationsmixin?view=azure-python#azure-cognitiveservices-vision-customvision-training-operations-customvisiontrainingclientoperationsmixin-create-image-regions"><code>CustomVisionTrainingClient.create_image_regions()</code></a></li>
</ul>
<p>We can see from the documentation that “There is a limit of 64 entries in a batch.”</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"20221016_CreateImageRegions_Body.json"</span>) <span class="im">as</span> json_file:</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    regions_dict <span class="op">=</span> json.load(json_file)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'We have a total of </span><span class="sc">{</span><span class="bu">len</span>(regions_dict[<span class="st">"regions"</span>])<span class="sc">:</span>_<span class="sc">}</span><span class="ss"> regions.'</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'The first two regions:'</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>regions_dict[<span class="st">'regions'</span>][:<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>We have a total of 1_279 regions.

The first two regions:</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>[{'imageId': '6e274dfc-411a-4bf3-9151-51b96f662248',
  'tagId': '91ffb5b0-fe25-4d72-9c65-14793183a3b9',
  'left': 0.6395582,
  'top': 0,
  'width': 0.10740108,
  'height': 0.14776269},
 {'imageId': '6e274dfc-411a-4bf3-9151-51b96f662248',
  'tagId': 'c9b15b62-6823-44a4-8fee-fa9d84e65a7e',
  'left': 0.772766,
  'top': 0.16059849,
  'width': 0.22664931,
  'height': 0.40633526}]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create batches of 60 regions</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>regions <span class="op">=</span> regions_dict[<span class="st">'regions'</span>]</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">int</span>(<span class="dv">1_279</span> <span class="op">/</span> <span class="dv">60</span>)<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    batch_regions <span class="op">=</span> []</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Creating Regions </span><span class="sc">{</span>i<span class="op">*</span><span class="dv">60</span><span class="op">+</span><span class="dv">1</span><span class="sc">:</span><span class="op">&gt;</span>{<span class="dv">5</span>}_<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span><span class="bu">min</span>((i<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span><span class="dv">60</span>, <span class="dv">1_279</span>)<span class="sc">:</span><span class="op">&gt;</span>{<span class="dv">5</span>}_<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> region <span class="kw">in</span> regions[i<span class="op">*</span><span class="dv">60</span>: (i<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span><span class="dv">60</span>]:</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        batch_regions.append(</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>            ImageRegionCreateEntry(</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>                image_id<span class="op">=</span>region[<span class="st">'imageId'</span>],</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>                tag_id<span class="op">=</span>region[<span class="st">'tagId'</span>],</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>                left<span class="op">=</span>region[<span class="st">'left'</span>], top<span class="op">=</span>region[<span class="st">'top'</span>],</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>                width<span class="op">=</span>region[<span class="st">'width'</span>], height<span class="op">=</span>region[<span class="st">'height'</span>]</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>        ))</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    training_client.create_image_regions(</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>        project_id<span class="op">=</span>project_id, </span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>        regions<span class="op">=</span>batch_regions</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Creating Regions     1 to    60
Creating Regions    61 to   120
Creating Regions   121 to   180
Creating Regions   181 to   240
Creating Regions   241 to   300
Creating Regions   301 to   360
Creating Regions   361 to   420
Creating Regions   421 to   480
Creating Regions   481 to   540
Creating Regions   541 to   600
Creating Regions   601 to   660
Creating Regions   661 to   720
Creating Regions   721 to   780
Creating Regions   781 to   840
Creating Regions   841 to   900
Creating Regions   901 to   960
Creating Regions   961 to 1_020
Creating Regions 1_021 to 1_080
Creating Regions 1_081 to 1_140
Creating Regions 1_141 to 1_200
Creating Regions 1_201 to 1_260
Creating Regions 1_261 to 1_279</code></pre>
</div>
</div>
<p>Example image in the service:<br>
<img src="./blog-pictures/Part-2-Regions.PNG" class="img-fluid"></p>
</section>
<section id="verifying-the-number-of-created-regions" class="level3">
<h3 class="anchored" data-anchor-id="verifying-the-number-of-created-regions">Verifying the number of created Regions</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>all_tagged_images <span class="op">=</span> training_client.get_images(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    project_id<span class="op">=</span>project_id,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    tagging_status<span class="op">=</span><span class="st">"Tagged"</span>, </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    take<span class="op">=</span><span class="dv">250</span>   <span class="co"># Max 256</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> im <span class="kw">in</span> all_tagged_images: i <span class="op">+=</span> <span class="bu">len</span>(im.regions)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of created Regions: </span><span class="sc">{</span>i<span class="sc">:</span>_<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of created Regions: 1_279</code></pre>
</div>
</div>
</section>
<section id="draw-some-regions" class="level3">
<h3 class="anchored" data-anchor-id="draw-some-regions">Draw some regions</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>images_df <span class="op">=</span> pd.read_csv(<span class="st">'20221015_203_Images_Uploaded_WxH.csv'</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>images_df.index <span class="op">=</span> images_df.image_id</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>images_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>image_name</th>
      <th>image_id</th>
      <th>image_status</th>
      <th>ori_w</th>
      <th>ori_h</th>
      <th>train_w</th>
      <th>train_h</th>
    </tr>
    <tr>
      <th>image_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>452a0b58-0dc5-41ff-83d1-8d1ae7bd5d1c</th>
      <td>41.JPG</td>
      <td>452a0b58-0dc5-41ff-83d1-8d1ae7bd5d1c</td>
      <td>OK</td>
      <td>640</td>
      <td>480</td>
      <td>640</td>
      <td>480</td>
    </tr>
    <tr>
      <th>96b7774e-f5ad-4591-aa71-99ad5c71135e</th>
      <td>CIMG0030.JPG</td>
      <td>96b7774e-f5ad-4591-aa71-99ad5c71135e</td>
      <td>OK</td>
      <td>1620</td>
      <td>2160</td>
      <td>900</td>
      <td>1200</td>
    </tr>
    <tr>
      <th>3027bc7e-6e21-4b13-a7d7-bb7e08ce6824</th>
      <td>CIMG0031.JPG</td>
      <td>3027bc7e-6e21-4b13-a7d7-bb7e08ce6824</td>
      <td>OK</td>
      <td>1620</td>
      <td>2160</td>
      <td>900</td>
      <td>1200</td>
    </tr>
    <tr>
      <th>1320ab2e-3405-4853-bd7e-b0ef0f915d4b</th>
      <td>CIMG0056.JPG</td>
      <td>1320ab2e-3405-4853-bd7e-b0ef0f915d4b</td>
      <td>OK</td>
      <td>2160</td>
      <td>1620</td>
      <td>1200</td>
      <td>900</td>
    </tr>
    <tr>
      <th>aa67eceb-3db0-4026-bf16-0842c006e6ac</th>
      <td>CIMG0059.JPG</td>
      <td>aa67eceb-3db0-4026-bf16-0842c006e6ac</td>
      <td>OK</td>
      <td>2160</td>
      <td>1620</td>
      <td>1200</td>
      <td>900</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Create a dictionary to easily access all regions from an image id:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>img2ann <span class="op">=</span> <span class="bu">dict</span>()</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> image <span class="kw">in</span> all_tagged_images:</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    img2ann[image.<span class="bu">id</span>] <span class="op">=</span> <span class="bu">tuple</span>([<span class="bu">list</span>(), <span class="bu">list</span>()])</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    image_w <span class="op">=</span> image.width<span class="op">;</span> image_h <span class="op">=</span> image.height</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    ori_w <span class="op">=</span> images_df.loc[image.<span class="bu">id</span>].ori_w</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    ori_h <span class="op">=</span> images_df.loc[image.<span class="bu">id</span>].ori_h</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> region <span class="kw">in</span> image.regions:</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>        img2ann[image.<span class="bu">id</span>][<span class="dv">1</span>].append(region.tag_name)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>        img2ann[image.<span class="bu">id</span>][<span class="dv">0</span>].append([</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>            region.left<span class="op">*</span>ori_w, </span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>            region.top<span class="op">*</span>ori_h, </span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>            region.width<span class="op">*</span>ori_w, </span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>            region.height<span class="op">*</span>ori_h</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>        ])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>pics_folder <span class="op">=</span> Path(<span class="st">'./train_images'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># https://youtu.be/Z0ssNAbe81M?t=4636</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_img(im, figsize<span class="op">=</span><span class="va">None</span>, ax<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> ax: fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>figsize)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    ax.imshow(im)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    ax.get_xaxis().set_visible(<span class="va">False</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    ax.get_yaxis().set_visible(<span class="va">False</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ax</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> draw_outline(o, lw):</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    o.set_path_effects([patheffects.Stroke(</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>        linewidth<span class="op">=</span>lw, foreground<span class="op">=</span><span class="st">'black'</span>), patheffects.Normal()</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> draw_rect(ax, b):</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    patch <span class="op">=</span> ax.add_patch(</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>        patches.Rectangle(b[:<span class="dv">2</span>], <span class="op">*</span>b[<span class="op">-</span><span class="dv">2</span>:], fill<span class="op">=</span><span class="va">False</span>, edgecolor<span class="op">=</span><span class="st">'white'</span>, lw<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    draw_outline(patch, <span class="dv">4</span>)</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> draw_text(ax, xy, txt, sz<span class="op">=</span><span class="dv">14</span>):</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> ax.text(<span class="op">*</span>xy, txt,</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>        verticalalignment<span class="op">=</span><span class="st">'top'</span>, color<span class="op">=</span><span class="st">'white'</span>, fontsize<span class="op">=</span>sz, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>    draw_outline(text, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> draw_regions(index<span class="op">=</span><span class="dv">0</span>):</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    im <span class="op">=</span> Image.<span class="bu">open</span>( pics_folder <span class="op">/</span> images_df.iloc[index].image_name )</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> show_img(im, figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>))</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    reg, lab <span class="op">=</span> img2ann[images_df.iloc[index].image_id]</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, region <span class="kw">in</span> <span class="bu">enumerate</span>(reg):</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>        draw_rect(ax, np.array(region))</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>        tag <span class="op">=</span> lab[idx]</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>        draw_text(ax, region[:<span class="dv">2</span>], tag)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>draw_regions(index<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="ObjectDetectionWithAzureCustomVision_Part_2_files/figure-html/cell-23-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>A dragon-fly was cought in that picture!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>draw_regions(index<span class="op">=</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="ObjectDetectionWithAzureCustomVision_Part_2_files/figure-html/cell-24-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="part-2.2.-train-and-test-a-model" class="level2">
<h2 class="anchored" data-anchor-id="part-2.2.-train-and-test-a-model">Part 2.2. Train and Test a Model</h2>
<ul>
<li><a href="https://learn.microsoft.com/en-us/python/api/azure-cognitiveservices-vision-customvision/azure.cognitiveservices.vision.customvision.training.operations.customvisiontrainingclientoperationsmixin?view=azure-python#azure-cognitiveservices-vision-customvision-training-operations-customvisiontrainingclientoperationsmixin-train-project"><code>CustomVisionTrainingClient.train_project()</code></a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>train_iteration <span class="op">=</span> training_client.train_project(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    project_id<span class="op">=</span>project_id,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    training_type<span class="op">=</span><span class="st">'Regular'</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="explore-pictures" class="level3">
<h3 class="anchored" data-anchor-id="explore-pictures">Explore pictures</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>pics_folder <span class="op">=</span> Path(<span class="st">'./train_images'</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>pictures <span class="op">=</span> <span class="bu">sorted</span>(<span class="bu">list</span>(pics_folder.iterdir()))</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"There are </span><span class="sc">{</span><span class="bu">len</span>(pictures)<span class="sc">}</span><span class="ss"> pictures"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>There are 203 pictures</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">3</span>, <span class="dv">4</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">12</span>))</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_img(im, figsize<span class="op">=</span><span class="va">None</span>, ax<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> ax: fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>figsize)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    ax.imshow(im)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    ax.get_xaxis().set_visible(<span class="va">False</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    ax.get_yaxis().set_visible(<span class="va">False</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ax</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, ax <span class="kw">in</span> <span class="bu">enumerate</span>(axes.flat):</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    im <span class="op">=</span> Image.<span class="bu">open</span>( pictures[i<span class="op">*</span><span class="dv">10</span>] )</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> show_img(im, ax<span class="op">=</span>ax)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="ObjectDetectionWithAzureCustomVision_Part_2_files/figure-html/cell-28-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>As you can see the pictures are very varied. Different cameras, lighting conditions, focus, resolutions and sizes…</p>
</section>
<section id="upload-the-pictures-to-custom-vision-service" class="level3">
<h3 class="anchored" data-anchor-id="upload-the-pictures-to-custom-vision-service">Upload the pictures to Custom Vision Service</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>uploaded_images_df <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span>[<span class="st">"image_name"</span>, <span class="st">"image_id"</span>, <span class="st">"image_status"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>upload_batch <span class="op">=</span> Upload_Images_1by1(pictures)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>uploaded_images_df <span class="op">=</span> pd.DataFrame(upload_batch)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>uploaded_images_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>image_name</th>
      <th>image_id</th>
      <th>image_status</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>41.JPG</td>
      <td>452a0b58-0dc5-41ff-83d1-8d1ae7bd5d1c</td>
      <td>OK</td>
    </tr>
    <tr>
      <th>1</th>
      <td>CIMG0030.JPG</td>
      <td>96b7774e-f5ad-4591-aa71-99ad5c71135e</td>
      <td>OK</td>
    </tr>
    <tr>
      <th>2</th>
      <td>CIMG0031.JPG</td>
      <td>3027bc7e-6e21-4b13-a7d7-bb7e08ce6824</td>
      <td>OK</td>
    </tr>
    <tr>
      <th>3</th>
      <td>CIMG0056.JPG</td>
      <td>1320ab2e-3405-4853-bd7e-b0ef0f915d4b</td>
      <td>OK</td>
    </tr>
    <tr>
      <th>4</th>
      <td>CIMG0059.JPG</td>
      <td>aa67eceb-3db0-4026-bf16-0842c006e6ac</td>
      <td>OK</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>198</th>
      <td>torre cerro el pavon 075.jpg</td>
      <td>b6dd061a-a68d-4d91-a39f-711968445571</td>
      <td>OK</td>
    </tr>
    <tr>
      <th>199</th>
      <td>torre cerro el pavon 080.jpg</td>
      <td>d12264cf-3d7b-469c-9445-da8dce8dabef</td>
      <td>OK</td>
    </tr>
    <tr>
      <th>200</th>
      <td>torre cerro el pavon 085.jpg</td>
      <td>c6d587fe-5f3a-46ea-bc04-7ff54f10b4ae</td>
      <td>OK</td>
    </tr>
    <tr>
      <th>201</th>
      <td>torre cerro el pavon 086.jpg</td>
      <td>ea34cbad-8d50-4b5f-aed0-91d7fe40a754</td>
      <td>OK</td>
    </tr>
    <tr>
      <th>202</th>
      <td>torre cerro el pavon 087.jpg</td>
      <td>6e274dfc-411a-4bf3-9151-51b96f662248</td>
      <td>OK</td>
    </tr>
  </tbody>
</table>
<p>203 rows × 3 columns</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="bu">sum</span>(uploaded_images_df.image_status <span class="op">!=</span> <span class="st">'OK'</span>)<span class="sc">}</span><span class="ss"> </span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="er">      images failed when uploading")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0 images failed uploading</code></pre>
</div>
</div>
<p>Save a csv:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>uploaded_images_df.to_csv(<span class="st">'20221012_203_Images_Uploaded.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="part-1.3.-explore-data-from-custom-vision-service" class="level2">
<h2 class="anchored" data-anchor-id="part-1.3.-explore-data-from-custom-vision-service">Part 1.3. Explore Data from Custom Vision Service</h2>
<section id="get-ids-of-uploaded-images" class="level3">
<h3 class="anchored" data-anchor-id="get-ids-of-uploaded-images">Get id’s of uploaded images</h3>
<ul>
<li><code>CustomVisionTrainingClient.get_images()</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>train_images <span class="op">=</span> training_client.get_images(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    project_id<span class="op">=</span>custom_vision_project.<span class="bu">id</span>,</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    take<span class="op">=</span><span class="dv">250</span>,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    skip<span class="op">=</span><span class="dv">0</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"There are </span><span class="sc">{</span><span class="bu">len</span>(train_images)<span class="sc">}</span><span class="ss"> training images in the service."</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Each image has a type of </span><span class="sc">{</span><span class="bu">type</span>(train_images[<span class="dv">0</span>])<span class="sc">}</span><span class="ss">."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>There are 203 training images in the service.
Each image has a type of &lt;class 'azure.cognitiveservices.vision.customvision.training.models._models_py3.Image'&gt;.</code></pre>
</div>
</div>
<p>Some properties of the image class:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>image <span class="op">=</span> train_images[<span class="dv">0</span>]</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"image.id: </span><span class="sc">{</span>image<span class="sc">.</span><span class="bu">id</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"image.width: </span><span class="sc">{</span>image<span class="sc">.</span>width<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"image.height: </span><span class="sc">{</span>image<span class="sc">.</span>height<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>image.id: 6e274dfc-411a-4bf3-9151-51b96f662248
image.width: 1188
image.height: 900</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>image.original_image_uri</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>'https://irisprodeutraining.blob.core.windows.net:443/i-f6cb4ba75bbe46a4883669654dc86f3a/o-6e274dfc411a4bf3915151b96f662248?sv=2020-04-08&amp;se=2022-10-16T22%3A23%3A43Z&amp;sr=b&amp;sp=r&amp;sig=ru8DNhvBrpA46oZtmzNP7CRHSkwGugumb3R%2F3IzJaUE%3D'</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>image.resized_image_uri</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>'https://irisprodeutraining.blob.core.windows.net:443/i-f6cb4ba75bbe46a4883669654dc86f3a/i-6e274dfc411a4bf3915151b96f662248?sv=2020-04-08&amp;se=2022-10-16T22%3A23%3A43Z&amp;sr=b&amp;sp=r&amp;sig=U5UQ6tjjdLF5gZHFR6wrrWk8B0w9at4cIUeYyxylx2E%3D'</code></pre>
</div>
</div>
<p>Of course there are no tags yet:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"image.tags: </span><span class="sc">{</span>image<span class="sc">.</span>tags<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>image.tags: None</code></pre>
</div>
</div>
</section>
<section id="the-images-are-resized-when-uploaded" class="level3">
<h3 class="anchored" data-anchor-id="the-images-are-resized-when-uploaded">The images are resized when uploaded</h3>
<p>Let’s see the same image locally:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>uploaded_images_df[uploaded_images_df.image_id<span class="op">==</span>image.<span class="bu">id</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>image_name</th>
      <th>image_id</th>
      <th>image_status</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>202</th>
      <td>torre cerro el pavon 087.jpg</td>
      <td>6e274dfc-411a-4bf3-9151-51b96f662248</td>
      <td>OK</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>local_image <span class="op">=</span> uploaded_images_df[</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    uploaded_images_df.image_id<span class="op">==</span><span class="st">'6e274dfc-411a-4bf3-9151-51b96f662248'</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>].image_name.item()</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>local_image</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>'torre cerro el pavon 087.jpg'</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>im <span class="op">=</span> Image.<span class="bu">open</span>(pics_folder <span class="op">/</span> local_image)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>im.size</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(2576, 1952)</code></pre>
</div>
</div>
<p>The local image has a size of (2576, 1952) and was resized to (1188, 900) by the service</p>
</section>
<section id="keep-track-of-original-size-vs.-size-in-the-service" class="level3">
<h3 class="anchored" data-anchor-id="keep-track-of-original-size-vs.-size-in-the-service">Keep track of original size vs.&nbsp;size in the service</h3>
<p>To get the real width and height we need to consider EXIF metadata. That’s because local images are sometimes rotated by the viewer with some app viewer.</p>
<section id="size-of-local-images" class="level4">
<h4 class="anchored" data-anchor-id="size-of-local-images">Size of local images</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The image has some EXIF meta data including information about orientation (rotation)</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co"># https://stackoverflow.com/a/63950647</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>local_w <span class="op">=</span> []</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>local_h <span class="op">=</span> []</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> image <span class="kw">in</span> uploaded_images_df.image_name:</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>    im <span class="op">=</span> Image.<span class="bu">open</span>(pics_folder <span class="op">/</span> image)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>    im <span class="op">=</span> ImageOps.exif_transpose(im)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>    local_w.append(im.size[<span class="dv">0</span>])</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>    local_h.append(im.size[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>local_w[:<span class="dv">5</span>], local_h[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>([640, 1620, 1620, 2160, 2160], [480, 2160, 2160, 1620, 1620])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>uploaded_images_df[<span class="st">'ori_w'</span>] <span class="op">=</span> local_w</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>uploaded_images_df[<span class="st">'ori_h'</span>] <span class="op">=</span> local_h</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>uploaded_images_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>image_name</th>
      <th>image_id</th>
      <th>image_status</th>
      <th>ori_w</th>
      <th>ori_h</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>41.JPG</td>
      <td>452a0b58-0dc5-41ff-83d1-8d1ae7bd5d1c</td>
      <td>OK</td>
      <td>640</td>
      <td>480</td>
    </tr>
    <tr>
      <th>1</th>
      <td>CIMG0030.JPG</td>
      <td>96b7774e-f5ad-4591-aa71-99ad5c71135e</td>
      <td>OK</td>
      <td>1620</td>
      <td>2160</td>
    </tr>
    <tr>
      <th>2</th>
      <td>CIMG0031.JPG</td>
      <td>3027bc7e-6e21-4b13-a7d7-bb7e08ce6824</td>
      <td>OK</td>
      <td>1620</td>
      <td>2160</td>
    </tr>
    <tr>
      <th>3</th>
      <td>CIMG0056.JPG</td>
      <td>1320ab2e-3405-4853-bd7e-b0ef0f915d4b</td>
      <td>OK</td>
      <td>2160</td>
      <td>1620</td>
    </tr>
    <tr>
      <th>4</th>
      <td>CIMG0059.JPG</td>
      <td>aa67eceb-3db0-4026-bf16-0842c006e6ac</td>
      <td>OK</td>
      <td>2160</td>
      <td>1620</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="size-of-images-in-the-service" class="level4">
<h4 class="anchored" data-anchor-id="size-of-images-in-the-service">Size of images in the service</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>service_ids <span class="op">=</span> [im.<span class="bu">id</span> <span class="cf">for</span> im <span class="kw">in</span> train_images]</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>service_w <span class="op">=</span> [im.width <span class="cf">for</span> im <span class="kw">in</span> train_images]</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>service_h <span class="op">=</span> [im.height <span class="cf">for</span> im <span class="kw">in</span> train_images]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>service_w <span class="op">=</span> {<span class="bu">id</span>: w <span class="cf">for</span> <span class="bu">id</span>, w <span class="kw">in</span> <span class="bu">zip</span>(service_ids, service_w)}</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>service_h <span class="op">=</span> {<span class="bu">id</span>: h <span class="cf">for</span> <span class="bu">id</span>, h <span class="kw">in</span> <span class="bu">zip</span>(service_ids, service_h)}</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>uploaded_images_df[<span class="st">'train_w'</span>] <span class="op">=</span> uploaded_images_df[<span class="st">'image_id'</span>].<span class="bu">map</span>(service_w)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>uploaded_images_df[<span class="st">'train_h'</span>] <span class="op">=</span> uploaded_images_df[<span class="st">'image_id'</span>].<span class="bu">map</span>(service_h)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="checking-consistency-in-the-ratios" class="level3">
<h3 class="anchored" data-anchor-id="checking-consistency-in-the-ratios">Checking consistency in the ratios</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>ori_ratio <span class="op">=</span> uploaded_images_df.ori_w <span class="op">/</span> uploaded_images_df.ori_h</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>train_ratio <span class="op">=</span> uploaded_images_df.train_w <span class="op">/</span> uploaded_images_df.train_h</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="bu">all</span>(<span class="bu">abs</span>(ori_ratio <span class="op">-</span> i_ratio) <span class="op">&gt;</span> <span class="fl">.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>False</code></pre>
</div>
</div>
<p>Images that has an inconsistent ratio:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>uploaded_images_df[<span class="bu">abs</span>(ori_ratio <span class="op">-</span> train_ratio) <span class="op">&gt;</span> <span class="fl">0.1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>image_name</th>
      <th>image_id</th>
      <th>image_status</th>
      <th>ori_w</th>
      <th>ori_h</th>
      <th>train_w</th>
      <th>train_h</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>179</th>
      <td>TORRE EL TIGRITO 01.jpg</td>
      <td>2563fffe-d621-4799-8e81-6ad57049cdaa</td>
      <td>OK</td>
      <td>480</td>
      <td>640</td>
      <td>640</td>
      <td>480</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>im <span class="op">=</span> Image.<span class="bu">open</span>( pics_folder <span class="op">/</span> <span class="st">'TORRE EL TIGRITO 01.jpg'</span> )</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>show_img(im)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="ObjectDetectionWithAzureCustomVision_Part_2_files/figure-html/cell-50-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>im.size</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(640, 480)</code></pre>
</div>
</div>
<p><code>ImageOps.exif_transpose</code> failed for this image.<br>
But if you don’t use it, more images would be inconsistent.<br>
If seems that <code>exif_transpose</code> keep track of manually rotated images.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>im <span class="op">=</span> ImageOps.exif_transpose(im)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>im.size</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(480, 640)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="bu">filter</span> <span class="op">=</span> uploaded_images_df.image_id <span class="op">==</span> <span class="st">'2563fffe-d621-4799-8e81-6ad57049cdaa'</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>uploaded_images_df.loc[<span class="bu">filter</span>, [<span class="st">'ori_w'</span>, <span class="st">'ori_h'</span>]] <span class="op">=</span> (<span class="dv">640</span>, <span class="dv">480</span>)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>uploaded_images_df[<span class="bu">filter</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>image_name</th>
      <th>image_id</th>
      <th>image_status</th>
      <th>ori_w</th>
      <th>ori_h</th>
      <th>train_w</th>
      <th>train_h</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>179</th>
      <td>TORRE EL TIGRITO 01.jpg</td>
      <td>2563fffe-d621-4799-8e81-6ad57049cdaa</td>
      <td>OK</td>
      <td>640</td>
      <td>480</td>
      <td>640</td>
      <td>480</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="exporting-csv-with-size-data" class="level3">
<h3 class="anchored" data-anchor-id="exporting-csv-with-size-data">Exporting csv with size data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>uploaded_images_df.sample(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>image_name</th>
      <th>image_id</th>
      <th>image_status</th>
      <th>ori_w</th>
      <th>ori_h</th>
      <th>train_w</th>
      <th>train_h</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>155</th>
      <td>P1100700.JPG</td>
      <td>b10efb57-70a4-48d6-a846-121ded4546f8</td>
      <td>OK</td>
      <td>2048</td>
      <td>1360</td>
      <td>1355</td>
      <td>900</td>
    </tr>
    <tr>
      <th>7</th>
      <td>CUMACA 11.jpg</td>
      <td>2c55467b-5de5-4329-91d2-a2fafdedd080</td>
      <td>OK</td>
      <td>2592</td>
      <td>1944</td>
      <td>1200</td>
      <td>900</td>
    </tr>
    <tr>
      <th>49</th>
      <td>IMG_1170.JPG</td>
      <td>ce2177ae-d03e-4a61-9dfb-4229542572fe</td>
      <td>OK</td>
      <td>480</td>
      <td>640</td>
      <td>480</td>
      <td>640</td>
    </tr>
    <tr>
      <th>141</th>
      <td>MVC-024S.JPG</td>
      <td>9ba84daa-e00c-4975-a07b-3ae23ef8f884</td>
      <td>OK</td>
      <td>640</td>
      <td>480</td>
      <td>640</td>
      <td>480</td>
    </tr>
    <tr>
      <th>136</th>
      <td>Imagen008.jpg</td>
      <td>c861b4de-127a-4dc0-84ea-9cb96fb380f2</td>
      <td>OK</td>
      <td>640</td>
      <td>480</td>
      <td>640</td>
      <td>480</td>
    </tr>
    <tr>
      <th>202</th>
      <td>torre cerro el pavon 087.jpg</td>
      <td>6e274dfc-411a-4bf3-9151-51b96f662248</td>
      <td>OK</td>
      <td>2576</td>
      <td>1952</td>
      <td>1188</td>
      <td>900</td>
    </tr>
    <tr>
      <th>145</th>
      <td>P1100611.JPG</td>
      <td>1148d437-fc44-4c51-af4a-4751e242b3b7</td>
      <td>OK</td>
      <td>2048</td>
      <td>1360</td>
      <td>1355</td>
      <td>900</td>
    </tr>
    <tr>
      <th>147</th>
      <td>P1100613.JPG</td>
      <td>c9dab11e-0663-42f8-8c93-4e2351b15d4c</td>
      <td>OK</td>
      <td>2048</td>
      <td>1360</td>
      <td>1355</td>
      <td>900</td>
    </tr>
    <tr>
      <th>171</th>
      <td>PICT0386.JPG</td>
      <td>0e51a561-b938-48f6-8bc6-3c3bf4c72c44</td>
      <td>OK</td>
      <td>2560</td>
      <td>1920</td>
      <td>1200</td>
      <td>900</td>
    </tr>
    <tr>
      <th>142</th>
      <td>MVC-025S.JPG</td>
      <td>a8c2a746-2a65-4872-b7b5-0bd5edf965c9</td>
      <td>OK</td>
      <td>640</td>
      <td>480</td>
      <td>640</td>
      <td>480</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>uploaded_images_df.to_csv(<span class="st">'20221015_203_Images_Uploaded_WxH.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="conslusions" class="level2">
<h2 class="anchored" data-anchor-id="conslusions">Conslusions</h2>
<ul>
<li>It was straightforward to upload images to the service.</li>
<li>Big images got resized, but their ratios were kept.</li>
<li><code>exif_transpose</code> needs to be used to get the real width and height of the image, but failed with one of them.</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Francisco Mussari">
<meta name="dcterms.date" content="2022-10-15">

<title>datamatica - Telecom Equipment Detection with Azure Custom Vision (Free) - Part 2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">datamatica</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/fmussari" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/francisco-mussari-432b781a6/" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Telecom Equipment Detection with Azure Custom Vision (Free) - Part 2</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">computer-vision</div>
                <div class="quarto-category">deeplearning</div>
                <div class="quarto-category">azure</div>
                <div class="quarto-category">custom-vision</div>
                <div class="quarto-category">object-detection</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Francisco Mussari </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">October 15, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#tutorial-parts" id="toc-tutorial-parts" class="nav-link" data-scroll-target="#tutorial-parts">Tutorial Parts</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  <li><a href="#part-2.1.-labeling-the-images" id="toc-part-2.1.-labeling-the-images" class="nav-link" data-scroll-target="#part-2.1.-labeling-the-images">Part 2.1. Labeling the Images</a>
  <ul class="collapse">
  <li><a href="#install-and-import-libraries" id="toc-install-and-import-libraries" class="nav-link" data-scroll-target="#install-and-import-libraries">Install and import libraries</a></li>
  <li><a href="#credentials-and-services" id="toc-credentials-and-services" class="nav-link" data-scroll-target="#credentials-and-services">Credentials and services</a></li>
  <li><a href="#creating-labels" id="toc-creating-labels" class="nav-link" data-scroll-target="#creating-labels">Creating Labels</a></li>
  <li><a href="#upload-regions-from-json-file" id="toc-upload-regions-from-json-file" class="nav-link" data-scroll-target="#upload-regions-from-json-file">Upload Regions from json file</a></li>
  <li><a href="#verifying-the-number-of-created-regions" id="toc-verifying-the-number-of-created-regions" class="nav-link" data-scroll-target="#verifying-the-number-of-created-regions">Verifying the number of created Regions</a></li>
  <li><a href="#draw-some-regions" id="toc-draw-some-regions" class="nav-link" data-scroll-target="#draw-some-regions">Draw some regions</a></li>
  </ul></li>
  <li><a href="#part-2.2.-train-and-test-a-model" id="toc-part-2.2.-train-and-test-a-model" class="nav-link" data-scroll-target="#part-2.2.-train-and-test-a-model">Part 2.2. Train and Test a Model</a>
  <ul class="collapse">
  <li><a href="#train-the-model" id="toc-train-the-model" class="nav-link" data-scroll-target="#train-the-model">Train the model</a></li>
  <li><a href="#test-the-model-quick-test" id="toc-test-the-model-quick-test" class="nav-link" data-scroll-target="#test-the-model-quick-test">Test the model (Quick Test)</a></li>
  </ul></li>
  <li><a href="#conslusions" id="toc-conslusions" class="nav-link" data-scroll-target="#conslusions">Conslusions</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>Part 2. Label images with Smart Labeler</p>
<p><img src="./blog-pictures/Part-2.PNG" class="img-fluid"></p>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>In this series of posts we are going to follow along the process and code required to train an <em>object detection</em> model using <a href="https://azure.microsoft.com/en-us/pricing/details/cognitive-services/custom-vision-service">Azure Custom Vision</a> (in its free tier).</p>
<p>-&gt; We are going to use real world pictures compiled from work I have done over the years in Venezuela. In this kind of <em>supervised learning</em> problem we need tagged images. So we will use <a href="https://learn.microsoft.com/en-us/azure/cognitive-services/custom-vision-service/suggested-tags">Smart Labeler</a> to do that.</p>
<p>After the model is published in Azure service, we can use the API to build and share a demo with <a href="https://gradio.app/">Gradio</a> and <a href="https://huggingface.co/">Huggingface</a>.</p>
<p>Here is the one that is already published for you to try:<br>
<a href="https://huggingface.co/spaces/fmussari/Telecom-Object-Detection">Telecom-Object-Detection</a></p>
<section id="the-model-will-be-trained-to-detect-the-following-objects" class="level4">
<h4 class="anchored" data-anchor-id="the-model-will-be-trained-to-detect-the-following-objects">The model will be trained to detect the following objects:</h4>
<ul>
<li>Grid Antenna</li>
<li>Panel antenna</li>
<li>Radome antenna</li>
<li>RRU</li>
<li>Shroud antenna</li>
<li>Solid antenna</li>
</ul>

<table>
<tbody><tr>
<td>
<img src="blog-pictures/Grid.jpg" alt="1" width="200px" height="200px">
</td>
<td>
<img src="blog-pictures/Panel.jpg" alt="2" width="200px" height="200px">
</td>
<td>
<img src="blog-pictures/Radome.jpg" alt="2" width="200px" height="200px">
</td>
</tr>
<tr>
<td>
Grid
</td>
<td>
Panel
</td>
<td>
Radome
</td>
</tr>
<tr>
<td>
<img src="blog-pictures/RRU.jpg" alt="1" width="200px" height="200px">
</td>
<td>
<img src="blog-pictures/Shroud.jpg" alt="1" width="200px" height="200px">
</td>
<td>
<img src="blog-pictures/Solid.jpg" alt="1" width="200px" height="200px">
</td>
</tr>
<tr>
<td>
RRU
</td>
<td>
Shroud
</td>
<td>
Solid
</td>
</tr>

</tbody></table>
</section>
</section>
<section id="tutorial-parts" class="level2">
<h2 class="anchored" data-anchor-id="tutorial-parts">Tutorial Parts</h2>
<ul>
<li><a href="../../posts/object-detection-with-azure-custom-vision/ObjectDetectionWithAzureCustomVision_Part_1.html">Part 1</a> covered:
<ul>
<li>Creating a <a href="https://azure.microsoft.com/en-us/pricing/details/cognitive-services/custom-vision-service/#pricing">free</a> Azure <a href="https://www.customvision.ai/">Custom Vision</a> Service.</li>
<li>Uploading the images to the service.</li>
</ul></li>
<li><strong>Part 2</strong>:
<ul>
<li>Analyzing what happens to the images after uploading.</li>
<li>How to label the images using <a href="https://learn.microsoft.com/en-us/azure/cognitive-services/custom-vision-service/suggested-tags">Smart Labeler</a></li>
<li>Training and testing the model.</li>
</ul></li>
<li><a href="../../posts/object-detection-with-azure-custom-vision/ObjectDetectionWithAzureCustomVision_Part_3.html">Part 3</a> will cover:
<ul>
<li>Create a Huggingface Gradio Demo.</li>
</ul></li>
</ul>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<ul>
<li>Custom Vision Documentation: <a href="https://learn.microsoft.com/en-us/azure/cognitive-services/custom-vision-service/suggested-tags">Label images faster with Smart Labeler</a></li>
<li>Microsoft Learn Excersice: <a href="https://microsoftlearning.github.io/AI-102-AIEngineer/Instructions/18-object-detection.html">Detect Objects in Images with Custom Vision</a></li>
<li>Custom Vision Documentation: <a href="https://docs.microsoft.com/en-us/azure/cognitive-services/custom-vision-service/quickstarts/object-detection?tabs=visual-studio&amp;pivots=programming-language-python">Quickstart: Create an object detection project with the Custom Vision client library</a></li>
<li>REST API Endpoint: <a href="https://docs.microsoft.com/en-us/rest/api/custom-vision/">Custom Vision REST API reference - Azure Cognitive Services</a></li>
<li>APIs Documentation: <a href="https://southcentralus.dev.cognitive.microsoft.com/docs/services/Custom_Vision_Training_3.3">Custom_Vision_Training_3.3</a></li>
<li>Azure SDK for Python: <a href="https://learn.microsoft.com/en-us/python/api/overview/azure/cognitiveservices-vision-customvision-readme?view=azure-python">Custom Vision Client Library</a></li>
<li>Source Code: <a href="https://github.com/Azure/azure-sdk-for-python/blob/main/sdk/cognitiveservices/azure-cognitiveservices-vision-customvision/azure/cognitiveservices/vision/customvision/training/operations/_custom_vision_training_client_operations.py">Azure/azure-sdk-for-python</a></li>
</ul>
</section>
<section id="part-2.1.-labeling-the-images" class="level2">
<h2 class="anchored" data-anchor-id="part-2.1.-labeling-the-images">Part 2.1. Labeling the Images</h2>
<p><strong>Smart Labeler</strong> is a simple tool for labeling images. It can be used for classification and object detection problems. When working in this problem I missed the ability to zoom-in when labeling some small objects, but as I said, this is a straightforward tool.</p>
<p>For speeding up bigger projects it might be usefull that you can first label some pictures, then train and get suggestions for the untagged images, but I didn’t use it. By default the labeler tries to give suggestions even without that first training.</p>
<p>The process is simple and you can the use the annotation to train models outside the service (as we are going to try after this series, hopefully, using fastai).</p>
<section id="install-and-import-libraries" class="level3">
<h3 class="anchored" data-anchor-id="install-and-import-libraries">Install and import libraries</h3>
<p>We need to install Custom Vision’s Python SDK and python-dotenv:<br>
<code>! pip install azure-cognitiveservices-vision-customvision==3.1.0</code><br>
<code>! pip install python-dotenv</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> azure.cognitiveservices.vision.customvision.training <span class="im">import</span> CustomVisionTrainingClient</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> azure.cognitiveservices.vision.customvision.training.models <span class="im">import</span> ImageFileCreateBatch, ImageFileCreateEntry, Region, ImageRegionCreateEntry</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> msrest.authentication <span class="im">import</span> ApiKeyCredentials</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image, ImageOps</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> UnidentifiedImageError</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> patches, patheffects</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="credentials-and-services" class="level3">
<h3 class="anchored" data-anchor-id="credentials-and-services">Credentials and services</h3>
<ul>
<li><a href="https://learn.microsoft.com/en-us/python/api/msrest/msrest.authentication.apikeycredentials?view=azure-python"><code>ApiKeyCredentials</code></a></li>
<li><a href="https://learn.microsoft.com/en-us/python/api/azure-cognitiveservices-vision-customvision/azure.cognitiveservices.vision.customvision.training.customvisiontrainingclient?view=azure-python"><code>CustomVisionTrainingClient</code></a></li>
<li><a href="https://learn.microsoft.com/en-us/python/api/azure-cognitiveservices-vision-customvision/azure.cognitiveservices.vision.customvision.training.operations.customvisiontrainingclientoperationsmixin?view=azure-python#azure-cognitiveservices-vision-customvision-training-operations-customvisiontrainingclientoperationsmixin-get-project"><code>CustomVisionTrainingClient.get_project()</code></a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>DOTENV_PATH <span class="op">=</span> <span class="st">'./.env'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>load_dotenv(DOTENV_PATH)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>training_endpoint <span class="op">=</span> os.getenv(<span class="st">'TrainingEndpoint'</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>training_key <span class="op">=</span> os.getenv(<span class="st">'TrainingKey'</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>project_id <span class="op">=</span> os.getenv(<span class="st">'ProjectID'</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>credentials <span class="op">=</span> ApiKeyCredentials(in_headers<span class="op">=</span>{<span class="st">"Training-key"</span>: training_key})</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>training_client <span class="op">=</span> CustomVisionTrainingClient(training_endpoint, credentials)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>custom_vision_project <span class="op">=</span> training_client.get_project(project_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="creating-labels" class="level3">
<h3 class="anchored" data-anchor-id="creating-labels">Creating Labels</h3>
<p>Since I already did the manual tagging, we can use those tags in this new project.<br>
First we need to create the labels/tags in the service: - <a href="https://learn.microsoft.com/en-us/python/api/azure-cognitiveservices-vision-customvision/azure.cognitiveservices.vision.customvision.training.operations.customvisiontrainingclientoperationsmixin?view=azure-python#azure-cognitiveservices-vision-customvision-training-operations-customvisiontrainingclientoperationsmixin-create-tag"><code>CustomVisionTrainingClient.create_tag()</code></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>tags <span class="op">=</span> [<span class="st">'Grid'</span>, <span class="st">'Panel'</span>, <span class="st">'Radome'</span>, <span class="st">'RRU'</span>, <span class="st">'Shroud'</span>, <span class="st">'Solid'</span>]</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>desc <span class="op">=</span> [<span class="st">'Grid Antenna'</span>, <span class="st">'Panel Cel. Antenna'</span>, <span class="st">'Radome Antenna'</span>, </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">'RRU Equipment'</span>, <span class="st">'Shroud Antenna'</span>, <span class="st">'Solid Antenna'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>service_tags <span class="op">=</span> []</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, tag <span class="kw">in</span> <span class="bu">enumerate</span>(tags):</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    service_tags.append(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        training_client.create_tag(</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>            project_id<span class="op">=</span>project_id, name<span class="op">=</span>tag,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>            description<span class="op">=</span>desc[i]</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>service_tags</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[&lt;azure.cognitiveservices.vision.customvision.training.models._models_py3.Tag&gt;,
 &lt;azure.cognitiveservices.vision.customvision.training.models._models_py3.Tag&gt;,
 &lt;azure.cognitiveservices.vision.customvision.training.models._models_py3.Tag&gt;,
 &lt;azure.cognitiveservices.vision.customvision.training.models._models_py3.Tag&gt;,
 &lt;azure.cognitiveservices.vision.customvision.training.models._models_py3.Tag&gt;,
 &lt;azure.cognitiveservices.vision.customvision.training.models._models_py3.Tag&gt;]</code></pre>
</div>
</div>
<p>Now we can see this in the service:<br>
<img src="./blog-pictures/Part-2-Tags.PNG" class="img-fluid"></p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/python/api/azure-cognitiveservices-vision-customvision/azure.cognitiveservices.vision.customvision.training.operations.customvisiontrainingclientoperationsmixin?view=azure-python#azure-cognitiveservices-vision-customvision-training-operations-customvisiontrainingclientoperationsmixin-get-images"><code>CustomVisionTrainingClient.get_tags()</code></a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>service_tags <span class="op">=</span> training_client.get_tags(project_id<span class="op">=</span>project_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>service_tag_ids <span class="op">=</span> {tag.name: tag.<span class="bu">id</span> <span class="cf">for</span> tag <span class="kw">in</span> service_tags}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>service_tag_ids</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'RRU': '91ffb5b0-fe25-4d72-9c65-14793183a3b9',
 'Shroud': '4e413c15-141a-419b-a958-1485008b2904',
 'Solid': '3f13d9b0-7b4d-4679-8fb8-7855cea0a118',
 'Radome': 'a1020654-79c5-4d8a-867c-93dfb2a4a81d',
 'Grid': 'e016b6a4-49e6-4897-a0c7-d8fc64d032f1',
 'Panel': 'c9b15b62-6823-44a4-8fee-fa9d84e65a7e'}</code></pre>
</div>
</div>
</section>
<section id="upload-regions-from-json-file" class="level3">
<h3 class="anchored" data-anchor-id="upload-regions-from-json-file">Upload Regions from json file</h3>
<p>As I pointed before, you can create all the regions with Smart Labeler. Since I did that already in a previos project, I updated the region’s image ids and tags to the ones in this project and save them as a json.</p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/python/api/azure-cognitiveservices-vision-customvision/azure.cognitiveservices.vision.customvision.training.operations.customvisiontrainingclientoperationsmixin?view=azure-python#azure-cognitiveservices-vision-customvision-training-operations-customvisiontrainingclientoperationsmixin-create-image-regions"><code>CustomVisionTrainingClient.create_image_regions()</code></a></li>
</ul>
<p>We can see from the documentation that “There is a limit of 64 entries in a batch.”</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"20221016_CreateImageRegions_Body.json"</span>) <span class="im">as</span> json_file:</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    regions_dict <span class="op">=</span> json.load(json_file)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'We have a total of </span><span class="sc">{</span><span class="bu">len</span>(regions_dict[<span class="st">"regions"</span>])<span class="sc">:</span>_<span class="sc">}</span><span class="ss"> regions.'</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'The first two regions:'</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>regions_dict[<span class="st">'regions'</span>][:<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>We have a total of 1_279 regions.

The first two regions:</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>[{'imageId': '6e274dfc-411a-4bf3-9151-51b96f662248',
  'tagId': '91ffb5b0-fe25-4d72-9c65-14793183a3b9',
  'left': 0.6395582,
  'top': 0.0,
  'width': 0.10740108,
  'height': 0.14776269},
 {'imageId': '6e274dfc-411a-4bf3-9151-51b96f662248',
  'tagId': 'c9b15b62-6823-44a4-8fee-fa9d84e65a7e',
  'left': 0.772766,
  'top': 0.16059849,
  'width': 0.22664931,
  'height': 0.40633526}]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create batches of 60 regions</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>regions <span class="op">=</span> regions_dict[<span class="st">'regions'</span>]</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">int</span>(<span class="dv">1_279</span> <span class="op">/</span> <span class="dv">60</span>)<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    batch_regions <span class="op">=</span> []</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Creating Regions </span><span class="sc">{</span>i<span class="op">*</span><span class="dv">60</span><span class="op">+</span><span class="dv">1</span><span class="sc">:</span><span class="op">&gt;</span>{<span class="dv">5</span>}_<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span><span class="bu">min</span>((i<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span><span class="dv">60</span>, <span class="dv">1_279</span>)<span class="sc">:</span><span class="op">&gt;</span>{<span class="dv">5</span>}_<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> region <span class="kw">in</span> regions[i<span class="op">*</span><span class="dv">60</span>: (i<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span><span class="dv">60</span>]:</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        batch_regions.append(</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>            ImageRegionCreateEntry(</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>                image_id<span class="op">=</span>region[<span class="st">'imageId'</span>],</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>                tag_id<span class="op">=</span>region[<span class="st">'tagId'</span>],</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>                left<span class="op">=</span>region[<span class="st">'left'</span>], top<span class="op">=</span>region[<span class="st">'top'</span>],</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>                width<span class="op">=</span>region[<span class="st">'width'</span>], height<span class="op">=</span>region[<span class="st">'height'</span>]</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>        ))</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    training_client.create_image_regions(</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>        project_id<span class="op">=</span>project_id, </span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>        regions<span class="op">=</span>batch_regions</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Creating Regions     1 to    60
Creating Regions    61 to   120
Creating Regions   121 to   180
Creating Regions   181 to   240
Creating Regions   241 to   300
Creating Regions   301 to   360
Creating Regions   361 to   420
Creating Regions   421 to   480
Creating Regions   481 to   540
Creating Regions   541 to   600
Creating Regions   601 to   660
Creating Regions   661 to   720
Creating Regions   721 to   780
Creating Regions   781 to   840
Creating Regions   841 to   900
Creating Regions   901 to   960
Creating Regions   961 to 1_020
Creating Regions 1_021 to 1_080
Creating Regions 1_081 to 1_140
Creating Regions 1_141 to 1_200
Creating Regions 1_201 to 1_260
Creating Regions 1_261 to 1_279</code></pre>
</div>
</div>
<p>Example image, capture from the service:<br>
<img src="./blog-pictures/Part-2-Regions.PNG" class="img-fluid"></p>
</section>
<section id="verifying-the-number-of-created-regions" class="level3">
<h3 class="anchored" data-anchor-id="verifying-the-number-of-created-regions">Verifying the number of created Regions</h3>
<ul>
<li><a href="https://learn.microsoft.com/en-us/python/api/azure-cognitiveservices-vision-customvision/azure.cognitiveservices.vision.customvision.training.operations.customvisiontrainingclientoperationsmixin?view=azure-python#azure-cognitiveservices-vision-customvision-training-operations-customvisiontrainingclientoperationsmixin-get-images"><code>CustomVisionTrainingClient.get_images()</code></a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>all_tagged_images <span class="op">=</span> training_client.get_images(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    project_id<span class="op">=</span>project_id,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    tagging_status<span class="op">=</span><span class="st">"Tagged"</span>, </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    take<span class="op">=</span><span class="dv">250</span>   <span class="co"># Max 256</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> im <span class="kw">in</span> all_tagged_images: i <span class="op">+=</span> <span class="bu">len</span>(im.regions)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of created Regions: </span><span class="sc">{</span>i<span class="sc">:</span>_<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of created Regions: 1_279</code></pre>
</div>
</div>
</section>
<section id="draw-some-regions" class="level3">
<h3 class="anchored" data-anchor-id="draw-some-regions">Draw some regions</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>images_df <span class="op">=</span> pd.read_csv(<span class="st">'20221015_203_Images_Uploaded_WxH.csv'</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>images_df.index <span class="op">=</span> images_df.image_id</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>images_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">image_name</th>
<th data-quarto-table-cell-role="th">image_id</th>
<th data-quarto-table-cell-role="th">image_status</th>
<th data-quarto-table-cell-role="th">ori_w</th>
<th data-quarto-table-cell-role="th">ori_h</th>
<th data-quarto-table-cell-role="th">train_w</th>
<th data-quarto-table-cell-role="th">train_h</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">image_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">452a0b58-0dc5-41ff-83d1-8d1ae7bd5d1c</td>
<td>41.JPG</td>
<td>452a0b58-0dc5-41ff-83d1-8d1ae7bd5d1c</td>
<td>OK</td>
<td>640</td>
<td>480</td>
<td>640</td>
<td>480</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">96b7774e-f5ad-4591-aa71-99ad5c71135e</td>
<td>CIMG0030.JPG</td>
<td>96b7774e-f5ad-4591-aa71-99ad5c71135e</td>
<td>OK</td>
<td>1620</td>
<td>2160</td>
<td>900</td>
<td>1200</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3027bc7e-6e21-4b13-a7d7-bb7e08ce6824</td>
<td>CIMG0031.JPG</td>
<td>3027bc7e-6e21-4b13-a7d7-bb7e08ce6824</td>
<td>OK</td>
<td>1620</td>
<td>2160</td>
<td>900</td>
<td>1200</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1320ab2e-3405-4853-bd7e-b0ef0f915d4b</td>
<td>CIMG0056.JPG</td>
<td>1320ab2e-3405-4853-bd7e-b0ef0f915d4b</td>
<td>OK</td>
<td>2160</td>
<td>1620</td>
<td>1200</td>
<td>900</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">aa67eceb-3db0-4026-bf16-0842c006e6ac</td>
<td>CIMG0059.JPG</td>
<td>aa67eceb-3db0-4026-bf16-0842c006e6ac</td>
<td>OK</td>
<td>2160</td>
<td>1620</td>
<td>1200</td>
<td>900</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Create a dictionary to easily access all regions from an image id:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>img2ann <span class="op">=</span> <span class="bu">dict</span>()</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> image <span class="kw">in</span> all_tagged_images:</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    img2ann[image.<span class="bu">id</span>] <span class="op">=</span> <span class="bu">tuple</span>([<span class="bu">list</span>(), <span class="bu">list</span>()])</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    image_w <span class="op">=</span> image.width<span class="op">;</span> image_h <span class="op">=</span> image.height</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    ori_w <span class="op">=</span> images_df.loc[image.<span class="bu">id</span>].ori_w</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    ori_h <span class="op">=</span> images_df.loc[image.<span class="bu">id</span>].ori_h</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> region <span class="kw">in</span> image.regions:</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>        img2ann[image.<span class="bu">id</span>][<span class="dv">1</span>].append(region.tag_name)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>        img2ann[image.<span class="bu">id</span>][<span class="dv">0</span>].append([</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>            region.left<span class="op">*</span>ori_w, </span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>            region.top<span class="op">*</span>ori_h, </span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>            region.width<span class="op">*</span>ori_w, </span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>            region.height<span class="op">*</span>ori_h</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>        ])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>pics_folder <span class="op">=</span> Path(<span class="st">'./train_images'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># https://youtu.be/Z0ssNAbe81M?t=4636</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_img(im, figsize<span class="op">=</span><span class="va">None</span>, ax<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> ax: fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>figsize)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    ax.imshow(im)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    ax.get_xaxis().set_visible(<span class="va">False</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    ax.get_yaxis().set_visible(<span class="va">False</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ax</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> draw_outline(o, lw):</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    o.set_path_effects([patheffects.Stroke(</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>        linewidth<span class="op">=</span>lw, foreground<span class="op">=</span><span class="st">'black'</span>), patheffects.Normal()</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> draw_rect(ax, b):</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    patch <span class="op">=</span> ax.add_patch(</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>        patches.Rectangle(b[:<span class="dv">2</span>], <span class="op">*</span>b[<span class="op">-</span><span class="dv">2</span>:], fill<span class="op">=</span><span class="va">False</span>, edgecolor<span class="op">=</span><span class="st">'white'</span>, lw<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    draw_outline(patch, <span class="dv">4</span>)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> draw_text(ax, xy, txt, sz<span class="op">=</span><span class="dv">14</span>):</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> ax.text(<span class="op">*</span>xy, txt,</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>        verticalalignment<span class="op">=</span><span class="st">'top'</span>, color<span class="op">=</span><span class="st">'white'</span>, fontsize<span class="op">=</span>sz, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>    draw_outline(text, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> draw_regions(index<span class="op">=</span><span class="dv">0</span>):</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    im <span class="op">=</span> Image.<span class="bu">open</span>( pics_folder <span class="op">/</span> images_df.iloc[index].image_name )</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> show_img(im, figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    reg, lab <span class="op">=</span> img2ann[images_df.iloc[index].image_id]</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, region <span class="kw">in</span> <span class="bu">enumerate</span>(reg):</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>        draw_rect(ax, np.array(region))</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>        tag <span class="op">=</span> lab[idx]</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>        draw_text(ax, region[:<span class="dv">2</span>], tag)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>draw_regions(index<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[329.19859199999996, 205.3586496, 53.42696959999999, 114.2365248], [249.3986112, 264.75866399999995, 112.4269696, 85.23652799999999]]</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="ObjectDetectionWithAzureCustomVision_Part_2_files/figure-html/cell-24-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>A dragon-fly was cought in that picture!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>draw_regions(index<span class="op">=</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="ObjectDetectionWithAzureCustomVision_Part_2_files/figure-html/cell-25-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="part-2.2.-train-and-test-a-model" class="level2">
<h2 class="anchored" data-anchor-id="part-2.2.-train-and-test-a-model">Part 2.2. Train and Test a Model</h2>
<section id="train-the-model" class="level3">
<h3 class="anchored" data-anchor-id="train-the-model">Train the model</h3>
<ul>
<li><a href="https://learn.microsoft.com/en-us/python/api/azure-cognitiveservices-vision-customvision/azure.cognitiveservices.vision.customvision.training.operations.customvisiontrainingclientoperationsmixin?view=azure-python#azure-cognitiveservices-vision-customvision-training-operations-customvisiontrainingclientoperationsmixin-train-project"><code>CustomVisionTrainingClient.train_project()</code></a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>train_iteration <span class="op">=</span> training_client.train_project(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    project_id<span class="op">=</span>project_id,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    training_type<span class="op">=</span><span class="st">'Regular'</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>train_iteration.as_dict()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'id': 'd0006e20-33dd-4806-9fe9-cfc3fca82552',
 'name': 'Iteration 1',
 'status': 'Training',
 'created': '2022-10-12T13:34:38.120Z',
 'last_modified': '2022-10-22T14:56:30.406Z',
 'project_id': 'f6cb4ba7-5bbe-46a4-8836-69654dc86f3a',
 'exportable': False,
 'training_type': 'Regular',
 'reserved_budget_in_hours': 0,
 'training_time_in_minutes': 0}</code></pre>
</div>
</div>
<ul>
<li><a href="https://learn.microsoft.com/en-us/python/api/azure-cognitiveservices-vision-customvision/azure.cognitiveservices.vision.customvision.training.operations.customvisiontrainingclientoperationsmixin?view=azure-python#azure-cognitiveservices-vision-customvision-training-operations-customvisiontrainingclientoperationsmixin-get-iteration-performance"><code>CustomVisionTrainingClient.get_iteration_performance()</code></a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>performance <span class="op">=</span> training_client.get_iteration_performance(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    project_id<span class="op">=</span>project_id,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    iteration_id<span class="op">=</span>train_iteration.<span class="bu">id</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>).as_dict()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> tag <span class="kw">in</span> performance[<span class="st">'per_tag_performance'</span>]:</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'/'</span><span class="op">*</span><span class="dv">20</span>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'tag:'</span>, tag[<span class="st">'name'</span>])</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'image count:'</span>, training_client.get_tag(</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>        project_id<span class="op">=</span>project_id, tag_id<span class="op">=</span>service_tags[tag[<span class="st">'name'</span>]]</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    ).image_count)</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'recall:'</span>, tag[<span class="st">'recall'</span>])</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'average_precision:'</span>, tag[<span class="st">'average_precision'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>////////////////////
tag: Shroud
image count: 140
recall: 0.35789475
average_precision: 0.7280897
////////////////////
tag: Panel
image count: 68
recall: 0.11392405
average_precision: 0.3710658
////////////////////
tag: Solid
image count: 88
recall: 0.21428572
average_precision: 0.4641156
////////////////////
tag: Grid
image count: 80
recall: 0.10526316
average_precision: 0.3784035
////////////////////
tag: Radome
image count: 20
recall: 0.0
average_precision: 0.051538005
////////////////////
tag: RRU
image count: 32
recall: 0.13043478
average_precision: 0.48053658</code></pre>
</div>
</div>
<p>Some things that I would take into account now that negatively impact the model performance: - I choose many images with small boxes. - Some tags are not represented equally, so we ended an unbalanced distribution. - And of course lets remember we only did a quick train.</p>
<p>This is a very good thread on some tips and tricks to improve object detection:</p>
<blockquote class="twitter-tweet blockquote">
<p lang="en" dir="ltr">
😨 Training an Object Detection Model is a very challenging task and involves tweaking so many knobs<br><br>Here is an exhaustive 🎁 tips &amp; tricks list 🎁 that you could use to boost your model performance <br><br>🧵 <a href="https://t.co/sOvEUhCCwg">pic.twitter.com/sOvEUhCCwg</a>
</p>
— AI Fast Track (<span class="citation" data-cites="ai_fast_track">@ai_fast_track</span>) <a href="https://twitter.com/ai_fast_track/status/1583125709685673985?ref_src=twsrc%5Etfw">October 20, 2022</a>
</blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</section>
<section id="test-the-model-quick-test" class="level3">
<h3 class="anchored" data-anchor-id="test-the-model-quick-test">Test the model (Quick Test)</h3>
<p>Quick test allows to test the model without publishing a prediction API.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load image and get height, width and channels</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>image_file <span class="op">=</span> Path(<span class="st">"./test_images/las-palmas-at-60-(20).jpg"</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>image <span class="op">=</span> Image.<span class="bu">open</span>(image_file)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>h, w, ch <span class="op">=</span> np.array(image).shape</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>show_img(image, figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>))<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="ObjectDetectionWithAzureCustomVision_Part_2_files/figure-html/cell-29-output-1.png" class="img-fluid"></p>
</div>
</div>
<ul>
<li><a href="https://learn.microsoft.com/en-us/python/api/azure-cognitiveservices-vision-customvision/azure.cognitiveservices.vision.customvision.training.operations.customvisiontrainingclientoperationsmixin?view=azure-python#azure-cognitiveservices-vision-customvision-training-operations-customvisiontrainingclientoperationsmixin-quick-test-image"><code>CustomVisionTrainingClient.quick_test_image()</code></a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Detect objects in the test image</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Detecting objects in'</span>, image_file)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(image_file, mode<span class="op">=</span><span class="st">"rb"</span>) <span class="im">as</span> image_data:</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> training_client.quick_test_image(</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>        project_id<span class="op">=</span>project_id, </span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>        image_data<span class="op">=</span>image_data,</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>        iteration_id<span class="op">=</span>train_iteration.<span class="bu">id</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Detecting objects in test_images/las-palmas-at-60-(20).jpg</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_reg_lab(results):</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    reg <span class="op">=</span> []<span class="op">;</span> lab <span class="op">=</span> []</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> prediction <span class="kw">in</span> results.predictions:</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Only show objects with a &gt; 50% probability</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (prediction.probability<span class="op">*</span><span class="dv">100</span>) <span class="op">&gt;</span> <span class="dv">50</span>:</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>            left <span class="op">=</span> prediction.bounding_box.left <span class="op">*</span> w</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>            top <span class="op">=</span> prediction.bounding_box.top <span class="op">*</span> h</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>            height <span class="op">=</span> prediction.bounding_box.height <span class="op">*</span> h</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>            width <span class="op">=</span>  prediction.bounding_box.width <span class="op">*</span> w</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>            reg.append([left, top, width, height])</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>            lab.append(prediction.tag_name)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> reg, lab</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> draw_regions(image):</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> show_img(image, figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>))</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    reg, lab <span class="op">=</span> get_reg_lab(results)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, region <span class="kw">in</span> <span class="bu">enumerate</span>(reg):</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>        draw_rect(ax, np.array(region))</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>        tag <span class="op">=</span> lab[idx]</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>        draw_text(ax, region[:<span class="dv">2</span>], tag)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>draw_regions(image)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="ObjectDetectionWithAzureCustomVision_Part_2_files/figure-html/cell-33-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>As you can see, it didn’t detect some antennas. But taking into account we did a regular training and the limitations mentioned in the training data, it is impressive that it got some right in such a complex problem as object detection.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>image_file <span class="op">=</span> Path(<span class="st">"./test_images/DSC09399.jpg"</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>image <span class="op">=</span> Image.<span class="bu">open</span>(image_file)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>h, w, ch <span class="op">=</span> np.array(image).shape</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>show_img(image, figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>))<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="ObjectDetectionWithAzureCustomVision_Part_2_files/figure-html/cell-34-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>draw_regions(image)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="ObjectDetectionWithAzureCustomVision_Part_2_files/figure-html/cell-35-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Not a good job in this one. But this result is with a “regular” training (quick).<br>
You can see in the Gradio demo <a href="https://huggingface.co/spaces/fmussari/Telecom-Object-Detection">Telecom Object Detection with Azure Custom Vision</a> that the model trained for 1 hour (free tier limit) does a better job with this picture.</p>
<p><img src="gradio_demo.png" alt="1" width="464" height="352"></p>
</section>
</section>
<section id="conslusions" class="level2">
<h2 class="anchored" data-anchor-id="conslusions">Conslusions</h2>
<ul>
<li>Object detection is a complex problem. The fact that the service does a reasonable good job with unbalanced training photos and with such a limited training time talks about the great margin for improvement.</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>